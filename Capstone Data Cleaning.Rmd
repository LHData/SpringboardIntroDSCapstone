---
title: "LAPD data exploration"
author: "Lael Hebert"
date: "March 19, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load packages
```{r}
library(dplyr)
```

## R Load data

Start by loading all the data into R with good column types. Fix column names.

```{r}
library(dplyr)
library(readr)
census_data_by_Neighborhood_Council <- read_csv("Census_Data_by_Neighborhood_Council.csv", 
    col_types = cols(Hispanic_pop = col_double(), 
        Owner_occ = col_skip(), Renter_occ = col_skip()))
reporting_districts <- read_csv("LAPD_Reporting_Districts.csv", 
    col_types = cols(AREA = col_skip(), OBJECTID = col_skip(), 
        PERIMETER = col_skip(), PREC = col_character(), 
        REPDIST = col_character(), Shape__Area = col_skip(), 
        Shape__Length = col_skip()))
reporting_districts <- rename(reporting_districts, reporting_district = REPDIST, division_number = PREC, division = APREC, bureau = BUREAU, basic_car = BASICCAR)

stops_data <- read_csv("Vehicle_and_Pedestrian_Stop_Data_2010_to_Present.csv", 
    col_types = cols(`Form Reference Number` = col_character(), 
        `Officer 1 Serial Number` = col_character(), 
        `Reporting District` = col_character(), 
        `Stop Date` = col_date(format = "%m/%d/%Y"), 
        `Stop Number` = col_character(), 
        `Stop Time` = col_time(format = "%H:%M")))
names(stops_data) = c("stop_number", "form_reference_number", "gender_code", "ethnicity_code", "ethnicity", "date", "time", "officer_1_serial", "officer_1_division_num", "division_1", "officer_2_serial", "Officer_2_division_num", "division_2", "reporting_district", "stop_type", "post_stop_activity")


```
Clean up the stops data. Add a year column, join it with the reporting districts data. Then rename the new columns.

```{r}
stops_data <- stops_data %>%
  mutate(year = year(date)) %>%
  left_join(reporting_districts, "reporting_district") %>%
  rename(stop_division_number = division_number, stop_division = division, stop_bureau = bureau, stop_basic_car = basic_car)
```

The population data is missing from the hispanic column in the census data. Fill it in by subtracting the popultions of the other ethnicities from the total population. Calculate the total population of the city. Then created a vector of the percentages of each ethnicity city-wide. 


```{r}
census_data$Hispanic_pop <- census_data$Total_pop - 
  census_data$White_pop -
  census_data$Black_pop -
  census_data$Ameri_es_pop -
  census_data$Asian_pop -
  census_data$Hawn_pi_pop -
  census_data$Other_pop -
  census_data$Multi_pop

city_pop_total <- sum(census_data$Total_pop)
pop_avg_citywide <- c(100*sum(census_data$White_pop)/city_pop_total,
                      100*sum(census_data$Black_pop)/city_pop_total,
                      100*sum(census_data$Ameri_es_pop)/city_pop_total,
                      100*sum(census_data$Asian_pop)/city_pop_total,
                      100*sum(census_data$Hawn_pi_pop)/city_pop_total,
                      100*sum(census_data$Hispanic_pop)/city_pop_total,
                      100*sum(census_data$Other_pop)/city_pop_total,
                      100*sum(census_data$Multi_pop)/city_pop_total)
names(pop_avg_citywide) <- c("Percent_White", "Percent_Black", "Percent_Ameri_es", "Percent_Asian", "Percent_Hawn_pi", 
                             "Percent_Hispanic", "Percent_Other", "Percent_Multi")
city_pop_total
pop_avg_citywide


#for later
stops_data %>% group_by(gender_code) %>% summarise(totals = n()/nrow(stops_data))
stops_data %>% group_by(ethnicity_code) %>% summarise(totals = n()/nrow(stops_data))
```

According to the [Census.gov website](https://www.census.gov/quickfacts/fact/table/losangelescitycalifornia,losangelescountycalifornia/POP010210), Los Angelos had a population of 3.79 million people in 2010. This is very close to the 3.73 million reported in our census data set from the neighborhood council. The percentages by each ethnicity also match well. It looks like our calculation for the hispanic population will work.

Now, let's combine all ethnicities that represent less than 2% of the population as "other." We'll change the ethnicity column in stops_data but leave the ethnicity_code column alone in case we need the original values later. 
```{r}
unique(stops_data$ethnicity)
stops_data <- stops_data %>% 
  mutate(ethnicity = ifelse(ethnicity %in% c("OTHER", "AMERICAN INDIAN", "MULTI-DESCENTS"), "OTHER", ethnicity))
unique(stops_data$ethnicity)


```

